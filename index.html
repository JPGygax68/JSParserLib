<!DOCTYPE html>
<html>
  <head>
  <!--
  <meta http-equiv="Pragma" content="no-store">
  <meta http-equiv="Pragma" content="no-cache">
  //-->
  <title>Web Page</title>
  <script type="text/javascript" src="jquery-1.7.2.min.js"></script>
  <script type="text/javascript" src="require.js"></script>
  <style type="text/css">
    .code.javascript > .keyWord { color: blue; }
    .code.javascript > .reservedWord { color: blue; font-style: italic; }
    .code.javascript > .identifier { color: black; }
    .code.javascript > .comment { color: green; }
    .code.javascript > .punctuator { color: orange; }
    .code.javascript > .stringLiteral { color: grey; }
  </style>
  <script type="text/javascript" id="js_source">
    var myFunc = function() {
      // This is a single-line comment
      /* Multiline comment 
       * 2nd line
       **/
      var obj = null;
      var mybool = false;
      var s = "This is a string.", s2 = "Another string";
      var s3 = "This is a multiline \
string";
      var s4 = 'Single-quote string';
      var s5 = 'Escape sequences: \0 \xaa \u1234'; 
    }
  </script>
  <script type="text/javascript">
    $(function() {
      console.log('Ready');
      require.config( {
        urlArgs: "bust=" +  (new Date()).getTime()
        //urlArgs: "bust=15"
      } );
      require(['./parser/reader', './parser/parser', './parser/javascript'], function(Reader, Parser, JS) {
        var source = $('#js_source').text();
        var reader = Reader.createReader(source);
        var parser = Parser.createParser(reader, JS.inputElement2);
        var elem;
        var i = 0;
        console.log('Starting to parse...');
        var $cont = $('<pre>').addClass('code').addClass('javascript');
        var last_type = '', $last_node;
        while ((elem = parser.getNextElement()) !== false) {
            var $node;
            if (elem.getType() === 'whiteSpace' && $last_node.hasClass('whiteSpace')) {
              $last_node.text( $last_node.text() + elem.getText() );
            }
            /* else if (elem.getType() === 'lineBreak') {
              $node = $('<br/>');
            } */
            else {
              $node = $('<span>').addClass( elem.getSubTypes().join(' ') ).text( elem.getText() );
            }
            $cont.append( $node );
            $last_node = $node;
            i += 1;
            if (i > 1000) throw "forced stop";
        }
        console.log(i + ' elements obtained.');
        $('body').append( $cont );
      });
    });
  </script>
  </head>
  <body>
  </body>
</html>